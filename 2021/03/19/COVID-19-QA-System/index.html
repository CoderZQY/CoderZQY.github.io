<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"coderzqy.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":5},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="JavaWeb 新冠肺炎知识与防护自动问答系统1、课设说明1. 问题描述​    新冠肺炎给全国人民带来巨大的威胁与灾难。为了更加有效的战胜它，首先需要尽可能了解它的特性与相关的防护知识。本选题的目的是：使用Java语言与技术，设计并实现一个基于因特网平台的“关于新冠肺炎知识与防护自动问答系统”。">
<meta property="og:type" content="article">
<meta property="og:title" content="COVID-19_QA_System">
<meta property="og:url" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/index.html">
<meta property="og:site_name" content="君莫良の博客">
<meta property="og:description" content="JavaWeb 新冠肺炎知识与防护自动问答系统1、课设说明1. 问题描述​    新冠肺炎给全国人民带来巨大的威胁与灾难。为了更加有效的战胜它，首先需要尽可能了解它的特性与相关的防护知识。本选题的目的是：使用Java语言与技术，设计并实现一个基于因特网平台的“关于新冠肺炎知识与防护自动问答系统”。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319154445900.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319162050909.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319163621089.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319163920815.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319164148235.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319181142222.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/1090617-20180815214345288-1095555724.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319201612853.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319201715863.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319201753125.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319201812105.png">
<meta property="og:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319201852152.png">
<meta property="article:published_time" content="2021-03-19T03:03:53.000Z">
<meta property="article:modified_time" content="2021-03-19T12:33:54.261Z">
<meta property="article:author" content="君莫良">
<meta property="article:tag" content="java爬虫">
<meta property="article:tag" content="问答系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/image-20210319154445900.png">

<link rel="canonical" href="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<script src="/lib/fireworks.js"></script>
  <title>COVID-19_QA_System | 君莫良の博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">君莫良の博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一只努力学习编程的猪头少年</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">32</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">7</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">15</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="君莫良">
      <meta itemprop="description" content="世人慌慌张张，不过图碎银几两">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="君莫良の博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          COVID-19_QA_System
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-19 11:03:53 / 修改时间：20:33:54" itemprop="dateCreated datePublished" datetime="2021-03-19T11:03:53+08:00">2021-03-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaweb/" itemprop="url" rel="index"><span itemprop="name">javaweb</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="JavaWeb-新冠肺炎知识与防护自动问答系统"><a href="#JavaWeb-新冠肺炎知识与防护自动问答系统" class="headerlink" title="JavaWeb 新冠肺炎知识与防护自动问答系统"></a>JavaWeb 新冠肺炎知识与防护自动问答系统</h1><h2 id="1、课设说明"><a href="#1、课设说明" class="headerlink" title="1、课设说明"></a>1、课设说明</h2><h3 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h3><p>​    新冠肺炎给全国人民带来巨大的威胁与灾难。为了更加有效的战胜它，首先需要尽可能了解它的特性与相关的防护知识。本选题的目的是：使用Java语言与技术，设计并实现一个基于因特网平台的“关于新冠肺炎知识与防护自动问答系统”。</p>
<a id="more"></a>

<h3 id="2-系统主要功能"><a href="#2-系统主要功能" class="headerlink" title="2. 系统主要功能"></a>2. 系统主要功能</h3><p>1）知识库扩充或增加更新功能。系统能人工或自动从互联网上爬取（或抽取或获取）与“新冠肺炎”相关的知识并整理成系统内部的某种格式（支持全文检索的方式）,存储入库。</p>
<p>2）人机问答子系统。提供丰富的（各种友好的界面–如可能的话如：语音界面?卡通拟人化界面？）人机界面，用于进行人机问答。</p>
<p>3）系统分为客户机部分、服务器部分、数据库部分。客户机部分可以是：网页形式、微信小程序形式、微信公众号形式、app形式、PC机上运行的正常程序的形式。服务器部分：用于与客户机进行网络通信与信息传输部分、互联网新冠相关知识爬取子系统部分、知识整理、索引、入库部分。数据库部分：支持全文问答的数据库组织与管理。</p>
<p>4）也可以做一个单独的PC机程序（上述三部分集成在一个程序中），单独安装并运行。</p>
<h2 id="2、系统实现"><a href="#2、系统实现" class="headerlink" title="2、系统实现"></a>2、系统实现</h2><p>该问答系统采用Maven技术，MVC三层架构，主要分为：</p>
<ul>
<li><p>用户模块：主要处理用户的注册、登录、以及密码修改等请求</p>
</li>
<li><p>问答模块：负责定时爬取肺炎新冠知识、搜索问题的最佳解答、以及数据库内容的部分显示</p>
</li>
</ul>
<p>系统功能框架图如下：</p>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319154445900.png" alt="image-20210319154445900"></p>
<h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h3><h4 id="1）导入所需的maven依赖"><a href="#1）导入所需的maven依赖" class="headerlink" title="1）导入所需的maven依赖"></a>1）导入所需的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- Servlet依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- Jsp依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- jstl表达式依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- standard标签库 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- mysql连接数据库 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!-- http核心类 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--httpclient依赖，爬取数据--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!--jsoup依赖，解析Html--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--结合操作工具包--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--bean实体注解工具包--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--汉语言包，主要用于分词--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hankcs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hanlp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>portable-1.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2）编写连接数据库的配置文件，命名为db-properties"><a href="#2）编写连接数据库的配置文件，命名为db-properties" class="headerlink" title="2）编写连接数据库的配置文件，命名为db.properties"></a>2）编写连接数据库的配置文件，命名为db.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/crawler?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">333</span></span><br></pre></td></tr></table></figure>
<h4 id="3）编写操作数据库的公共类BaseDao"><a href="#3）编写操作数据库的公共类BaseDao" class="headerlink" title="3）编写操作数据库的公共类BaseDao"></a>3）编写操作数据库的公共类BaseDao</h4><p>在类加载时读取db.properties配置文件，完成初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">//操作数据库的公共类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.静态代码块，类加载时完成初始化</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">//通过类加载器读取对应的资源</span></span><br><span class="line">        InputStream is = BaseDao.class.getClassLoader().getResourceAsStream(<span class="string">&quot;db.properties&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prop.load(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        driver = prop.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = prop.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        username = prop.getProperty(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        password = prop.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取数据库的连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConn</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//编写查询公共类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ResultSet <span class="title">execute</span><span class="params">(Connection conn, PreparedStatement ps, ResultSet rs, String sql, Object[] params)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            ps.setObject(i+<span class="number">1</span>,params[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        rs = ps.executeQuery();</span><br><span class="line">        <span class="keyword">return</span> rs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//编写增删改公共方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">execute</span><span class="params">(Connection conn,PreparedStatement ps,String sql,Object[] params)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            ps.setObject(i+<span class="number">1</span>,params[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> updateRows = ps.executeUpdate();</span><br><span class="line">        <span class="keyword">return</span> updateRows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放资源</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">closeResource</span><span class="params">(Connection conn,PreparedStatement ps,ResultSet rs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(rs != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">                rs = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ps != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ps.close();</span><br><span class="line">                ps = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">                conn = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4）表设计"><a href="#4）表设计" class="headerlink" title="4）表设计"></a>4）表设计</h4><ol>
<li>用户表（user）设计</li>
</ol>
<table>
<thead>
<tr>
<th><strong>字段名</strong></th>
<th><strong>类型</strong></th>
<th><strong>长度</strong></th>
<th><strong>约束</strong></th>
<th><strong>自增</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>id</strong></td>
<td><strong>int</strong></td>
<td><strong>0</strong></td>
<td><strong>Pk</strong></td>
<td><strong>√</strong></td>
<td><strong>主键</strong></td>
</tr>
<tr>
<td><strong>userName</strong></td>
<td><strong>varchar</strong></td>
<td><strong>255</strong></td>
<td><strong>Unique</strong></td>
<td></td>
<td><strong>用户名</strong></td>
</tr>
<tr>
<td><strong>userPassword</strong></td>
<td><strong>varchar</strong></td>
<td><strong>255</strong></td>
<td><strong>Not null</strong></td>
<td></td>
<td><strong>密码</strong></td>
</tr>
</tbody></table>
<ol start="2">
<li>新冠问答表(covid)设计</li>
</ol>
<table>
<thead>
<tr>
<th><strong>字段名</strong></th>
<th><strong>类型</strong></th>
<th><strong>长度</strong></th>
<th><strong>约束</strong></th>
<th><strong>自增</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>id</strong></td>
<td><strong>Int</strong></td>
<td><strong>0</strong></td>
<td><strong>Pk</strong></td>
<td><strong>√</strong></td>
<td><strong>主键</strong></td>
</tr>
<tr>
<td><strong>question</strong></td>
<td><strong>Varchar</strong></td>
<td><strong>255</strong></td>
<td><strong>Unique</strong></td>
<td></td>
<td><strong>问题</strong></td>
</tr>
<tr>
<td><strong>answer</strong></td>
<td><strong>Text</strong></td>
<td><strong>0</strong></td>
<td><strong>Not null</strong></td>
<td></td>
<td><strong>答案</strong></td>
</tr>
<tr>
<td><strong>createDate</strong></td>
<td><strong>datetime</strong></td>
<td><strong>0</strong></td>
<td></td>
<td></td>
<td><strong>更新日期</strong></td>
</tr>
</tbody></table>
<h4 id="5-主类User、QA的编写"><a href="#5-主类User、QA的编写" class="headerlink" title="5) 主类User、QA的编写"></a>5) 主类User、QA的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id; <span class="comment">//id</span></span><br><span class="line">    <span class="keyword">private</span> String userName; <span class="comment">//用户名称</span></span><br><span class="line">    <span class="keyword">private</span> String userPassword; <span class="comment">//用户密码</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userPassword;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserPassword</span><span class="params">(String userPassword)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userPassword = userPassword;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String question;</span><br><span class="line">    <span class="keyword">private</span> String answer;</span><br><span class="line">    <span class="keyword">private</span> Date creationDate; <span class="comment">//创建时间</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQuestion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> question;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuestion</span><span class="params">(String question)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.question = question;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAnswer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAnswer</span><span class="params">(String answer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.answer = answer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreationDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> creationDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreationDate</span><span class="params">(Date creationDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.creationDate = creationDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6）编写CharacterEncodingFilter（字符编码过滤器）类"><a href="#6）编写CharacterEncodingFilter（字符编码过滤器）类" class="headerlink" title="6）编写CharacterEncodingFilter（字符编码过滤器）类"></a>6）编写CharacterEncodingFilter（字符编码过滤器）类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CharacterEncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        servletRequest.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        servletResponse.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>web.xml中对应配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--字符编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.zqy.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-用户模块"><a href="#2-用户模块" class="headerlink" title="2. 用户模块"></a>2. 用户模块</h3><p>业务流程图如下：</p>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319162050909.png" alt="image-20210319162050909"></p>
<p>采用自底向上实现的方式编写代码</p>
<h4 id="1）UserDao接口的编写"><a href="#1）UserDao接口的编写" class="headerlink" title="1）UserDao接口的编写"></a>1）UserDao接口的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.dao.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注册用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">register</span><span class="params">(Connection conn, String userName, String userPassword)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//用户登录</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(Connection conn, String userName, String userPassword)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//密码修改</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updatePwd</span><span class="params">(Connection conn, <span class="keyword">int</span> id, String userPassword)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2）接口实现类UserDaoImpl的编写"><a href="#2）接口实现类UserDaoImpl的编写" class="headerlink" title="2）接口实现类UserDaoImpl的编写"></a>2）接口实现类UserDaoImpl的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.dao.user.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.BaseDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.user.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">register</span><span class="params">(Connection conn, String userName, String userPassword)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;insert into user(userName,userPassword) VALUES (?,?)&quot;</span>;</span><br><span class="line">            Object[] params = &#123;userName,userPassword&#125;;</span><br><span class="line">            <span class="keyword">int</span> rows = BaseDao.execute(conn,pstm,sql,params);</span><br><span class="line">            <span class="keyword">if</span>(rows == <span class="number">1</span>)&#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(Connection conn, String userName, String userPassword)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;select * from user where userName = ? and userPassword = ?&quot;</span>;</span><br><span class="line">            Object[] params = &#123;userName,userPassword&#125;;</span><br><span class="line">            rs = BaseDao.execute(conn,pstm,rs,sql,params);</span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                user = <span class="keyword">new</span> User();</span><br><span class="line">                user.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                user.setUserName(rs.getString(<span class="string">&quot;userName&quot;</span>));</span><br><span class="line">                user.setUserPassword(rs.getString(<span class="string">&quot;userPassword&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updatePwd</span><span class="params">(Connection conn, <span class="keyword">int</span> id, String userPassword)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;update user set userPassword=? where id=?&quot;</span>;</span><br><span class="line">            Object[] params = &#123;userPassword,id&#125;;</span><br><span class="line">            <span class="keyword">int</span> rows = BaseDao.execute(conn,pstm,sql,params);</span><br><span class="line">            <span class="keyword">if</span>(rows == <span class="number">1</span>)&#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3）UserService业务层接口的编写"><a href="#3）UserService业务层接口的编写" class="headerlink" title="3）UserService业务层接口的编写"></a>3）UserService业务层接口的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.service.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//用户登录</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String userName, String userPassword)</span></span>;</span><br><span class="line">    <span class="comment">//用户注册</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">register</span><span class="params">(String userName, String userPassword)</span></span>;</span><br><span class="line">    <span class="comment">//密码更新</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updatePwd</span><span class="params">(<span class="keyword">int</span> id, String userPassword)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4）接口实现类UserServiceImpl的编写"><a href="#4）接口实现类UserServiceImpl的编写" class="headerlink" title="4）接口实现类UserServiceImpl的编写"></a>4）接口实现类UserServiceImpl的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.service.user.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.BaseDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.user.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.user.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//业务层都会调用dao层，所以我们要引入dao</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String userName, String userPassword)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = userDao.login(connection,userName,userPassword);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">register</span><span class="params">(String userName, String userPassword)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            flag = userDao.register(connection,userName,userPassword);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updatePwd</span><span class="params">(<span class="keyword">int</span> id, String userPassword)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            flag = userDao.updatePwd(connection,id,userPassword);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5）用户模块Servlet层的编写"><a href="#5）用户模块Servlet层的编写" class="headerlink" title="5）用户模块Servlet层的编写"></a>5）用户模块Servlet层的编写</h4><h5 id="1-LoginServlet的编写，负责处理用户的注册、登录"><a href="#1-LoginServlet的编写，负责处理用户的注册、登录" class="headerlink" title="1. LoginServlet的编写，负责处理用户的注册、登录"></a>1. LoginServlet的编写，负责处理用户的注册、登录</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.servlet.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.UserService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.util.Constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//Servlet：控制层、调用业务层代码</span></span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取请求功能</span></span><br><span class="line">        String op = req.getParameter(<span class="string">&quot;operation&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取前台表单中的信息</span></span><br><span class="line">        String userName = req.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        String userPassword = req.getParameter(<span class="string">&quot;userPassword&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;register&quot;</span>.equals(op))&#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setUserName(userName);</span><br><span class="line">            user.setUserPassword(userPassword);</span><br><span class="line">            <span class="keyword">boolean</span> flag = userService.register(userName,userPassword);</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                <span class="comment">//注册成功</span></span><br><span class="line">                req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;&lt;font color=&#x27;green&#x27;&gt;注册成功,请输入用户名密码登陆&lt;/font&gt;&quot;</span>);</span><br><span class="line">                <span class="comment">//跳转</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//注册失败</span></span><br><span class="line">                req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;注册失败,请检查!&quot;</span>);</span><br><span class="line">                <span class="comment">//跳转</span></span><br><span class="line">            &#125;</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;loginAndRegister.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//登陆功能</span></span><br><span class="line">            User user = userService.login(userName, userPassword);</span><br><span class="line">            <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//登陆成功，将当前用户保存到session中</span></span><br><span class="line">                req.getSession().setAttribute(Constants.USER_SESSION,user);</span><br><span class="line">                req.getRequestDispatcher(<span class="string">&quot;main.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//用户不存在</span></span><br><span class="line">                req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">                req.getRequestDispatcher(<span class="string">&quot;loginAndRegister.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-UpdatePwdServlet的编写，负责处理用户修改密码"><a href="#2-UpdatePwdServlet的编写，负责处理用户修改密码" class="headerlink" title="2. UpdatePwdServlet的编写，负责处理用户修改密码"></a>2. UpdatePwdServlet的编写，负责处理用户修改密码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.servlet.user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.UserService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.util.Constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdatePwdServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      <span class="comment">//Servlet：控制层、调用业务层代码</span></span><br><span class="line">      UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取前端输入的原始密码</span></span><br><span class="line">      String oldpass = request.getParameter(<span class="string">&quot;oldpass&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//密码匹配</span></span><br><span class="line">      User user = (User)request.getSession().getAttribute(Constants.USER_SESSION);</span><br><span class="line">      <span class="keyword">if</span>(oldpass.equals(user.getUserPassword()))&#123;</span><br><span class="line">         <span class="comment">//原始密码正确</span></span><br><span class="line">         <span class="comment">//获取前端的新密码</span></span><br><span class="line">         String newpass = request.getParameter(<span class="string">&quot;newpass&quot;</span>);</span><br><span class="line">         <span class="keyword">boolean</span> flag = userService.updatePwd(user.getId(),newpass);</span><br><span class="line">         <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="comment">//密码修改成功</span></span><br><span class="line">            <span class="comment">//密码更正，重新将用户信息设置到session中</span></span><br><span class="line">            user.setUserPassword(newpass);</span><br><span class="line">            request.getSession().setAttribute(Constants.USER_SESSION, user);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;success&quot;</span>, <span class="string">&quot;密码修改成功&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;updatePassword.jsp&quot;</span>).forward(request, response);</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;密码修改失败&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;updatePassword.jsp&quot;</span>).forward(request, response);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="comment">//密码输入错误</span></span><br><span class="line">         request.setAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;原始密码不正确&quot;</span>);</span><br><span class="line">         request.getRequestDispatcher(<span class="string">&quot;updatePassword.jsp&quot;</span>).forward(request, response);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      doGet(request,response);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-对应在web-xml文件中添加请求映射"><a href="#3-对应在web-xml文件中添加请求映射" class="headerlink" title="3. 对应在web.xml文件中添加请求映射"></a>3. 对应在web.xml文件中添加请求映射</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--loginServlet登录--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.user.LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--UpdatePwdServlet修改密码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>updatePwd<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.user.UpdatePwdServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>updatePwd<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/updatePwd<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="6）前端jsp页面代码"><a href="#6）前端jsp页面代码" class="headerlink" title="6）前端jsp页面代码"></a>6）前端jsp页面代码</h4><h5 id="1-loginAndRegister-jsp"><a href="#1-loginAndRegister-jsp" class="headerlink" title="1. loginAndRegister.jsp"></a>1. loginAndRegister.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;登录注册界面&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">   table&#123;</span><br><span class="line">      position:absolute;</span><br><span class="line">      top:5cm;</span><br><span class="line">      left:15cm;</span><br><span class="line">      width:400px;</span><br><span class="line">      height:250px;</span><br><span class="line">      border:2px solid #2BA8E8;</span><br><span class="line">   &#125;</span><br><span class="line">   .input&#123;</span><br><span class="line">      width:260px;</span><br><span class="line">      height:30px;</span><br><span class="line">      font-size:20px;</span><br><span class="line">   &#125;</span><br><span class="line">   .btn&#123;</span><br><span class="line">      cursor:pointer;</span><br><span class="line">      height:40px;</span><br><span class="line">      width:70px;</span><br><span class="line">      font-size:20px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">   &#125;</span><br><span class="line">   .title&#123;</span><br><span class="line">      font-style: italic;</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;body bgcolor=<span class="string">&quot;#f5f5f5&quot;</span> text=<span class="string">&quot;black&quot;</span>&gt;</span><br><span class="line">  &lt;!-- 表单开始 --&gt;</span><br><span class="line">          &lt;form name=<span class="string">&quot;form1&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">         &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;operation&quot;</span> value=<span class="string">&quot;register&quot;</span>/&gt;             </span><br><span class="line">             &lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                   &lt;th colspan=&quot;2&quot; style=&quot;font-size:30px;font-family: 华文行楷&quot;&gt;用户登陆注册&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                   &lt;th colspan=&quot;2&quot; style=&quot;color:red&quot; id=&quot;msg&quot;&gt;$&#123;msg&#125;&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                   &lt;td class=&quot;title&quot;&gt;USERNAME:&lt;/td&gt;</span><br><span class="line">                   &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;userName&quot;&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;   </span><br><span class="line">                   &lt;td class=&quot;title&quot;&gt;PASSWORD:&lt;/td&gt;</span><br><span class="line">                   &lt;td&gt;&lt;input type=&quot;password&quot; class=&quot;input&quot; name=&quot;userPassword&quot;&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                   &lt;td colspan=<span class="string">&quot;2&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">                      &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;登陆&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span> onclick=<span class="string">&quot;return login()&quot;</span>/&gt;</span><br><span class="line">                      &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;注册&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span> onclick=<span class="string">&quot;return register()&quot;</span>/&gt;</span><br><span class="line">                   &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                   &lt;td colspan=&quot;3&quot; align=&quot;center&quot;&gt;copyRight &amp;copy;&lt;i&gt; 2020 Zhang QingYang&lt;/i&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">             &lt;/table&gt;</span><br><span class="line">          &lt;/form&gt;</span><br><span class="line">          &lt;!-- 表单结束 --&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">   <span class="comment">//获取表单对象</span></span><br><span class="line">   <span class="keyword">var</span> form1 = document.form1;</span><br><span class="line">   <span class="comment">//获取错误信息显示位置的对象</span></span><br><span class="line">   <span class="keyword">var</span> msg = document.getElementById(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="function">function <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">var</span> operation = form1.operation.value;</span><br><span class="line">      form1.operation.value = <span class="string">&quot;login&quot;</span>;</span><br><span class="line">      <span class="comment">//获取用户名</span></span><br><span class="line">      <span class="keyword">var</span> username = form1.userName.value;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//获取密码</span></span><br><span class="line">      <span class="keyword">var</span> password = form1.userPassword.value;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(username.length&lt;<span class="number">1</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;请输入用户名&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(password.length&lt;<span class="number">1</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;请输入密码&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//页面跳转</span></span><br><span class="line">   form1.action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/login&quot;</span>;</span><br><span class="line">   form1.submit();</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="function">function <span class="title">register</span><span class="params">()</span></span>&#123;</span><br><span class="line">      form1.operation.value = <span class="string">&quot;register&quot;</span>;</span><br><span class="line">      <span class="comment">//获取用户名</span></span><br><span class="line">      <span class="keyword">var</span> username = form1.userName.value;</span><br><span class="line">      <span class="comment">//获取密码</span></span><br><span class="line">      <span class="keyword">var</span> password = form1.userPassword.value;</span><br><span class="line">      <span class="comment">//验证用户名</span></span><br><span class="line">      <span class="keyword">if</span>(username.length&lt;<span class="number">1</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;请输入用户名&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(username.length&lt;<span class="number">3</span> || username.length&gt;<span class="number">8</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;用户名长度在3~8之间&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//验证密码</span></span><br><span class="line">      <span class="keyword">if</span>(password.length&lt;<span class="number">1</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;请输入密码&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(password.length&lt;<span class="number">6</span> || password.length&gt;<span class="number">18</span>)&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;密码长度在6~18之间&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         msg.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      form1.action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/login&quot;</span>;</span><br><span class="line">      form1.submit();</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>在web.xml中设置成欢迎界面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--设置欢迎界面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>loginAndRegister.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在web.xml中配置映射请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--loginServlet登录--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.user.LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-updatePassword-jsp"><a href="#2-updatePassword-jsp" class="headerlink" title="2. updatePassword.jsp"></a>2. updatePassword.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=utf-8&quot;</span> pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;  </span><br><span class="line">    &lt;title&gt;My JSP &#x27;updatePassword.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">  .input&#123;</span><br><span class="line">      height:30px;</span><br><span class="line">      width:250px; </span><br><span class="line">      font-size:20px;    </span><br><span class="line">   &#125;</span><br><span class="line">   table&#123;</span><br><span class="line">      position:absolute;</span><br><span class="line">      left:<span class="number">30</span>%;</span><br><span class="line">      border:2px solid purple;</span><br><span class="line">   &#125;</span><br><span class="line">   .btn&#123;</span><br><span class="line">      cursor:pointer;</span><br><span class="line">      height:40px;</span><br><span class="line">      width:70px;</span><br><span class="line">      font-size:20px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      border:<span class="number">0</span>;</span><br><span class="line">      background-color: green;</span><br><span class="line">      color:white;</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;body bgcolor=<span class="string">&quot;#f5f5f5&quot;</span>&gt;</span><br><span class="line">    &lt;form onsubmit=<span class="string">&quot;return check()&quot;</span> name=<span class="string">&quot;form1&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">       &lt;table&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;th colspan=&quot;3&quot; style=&quot;font-size:25;font-style: oblique&quot;&gt;用户密码修改&lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;th colspan=&quot;3&quot; style=&quot;color:green&quot;&gt;$&#123;success&#125;&lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;td align=&quot;right&quot;&gt;原始密码:&lt;/td&gt;</span><br><span class="line">             &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;oldpass&quot; class=&quot;input&quot;&gt;&lt;/td&gt;</span><br><span class="line">             &lt;td width=&quot;200px&quot; id=&quot;e1&quot; style=&quot;color:red;font-weight:bold&quot;&gt;$&#123;error&#125;&lt;/td&gt;</span><br><span class="line">         &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;td align=&quot;right&quot;&gt;新密码:&lt;/td&gt;</span><br><span class="line">             &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;newpass&quot; class=&quot;input&quot;&gt;&lt;/td&gt;</span><br><span class="line">             &lt;td width=&quot;200px&quot; id=&quot;e2&quot; style=&quot;color:red;font-weight:bold&quot;&gt;&lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;td align=&quot;right&quot;&gt;重复密码:&lt;/td&gt;</span><br><span class="line">             &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;repass&quot; class=&quot;input&quot; onblur=&quot;return reCheck()&quot;&gt;&lt;/td&gt;</span><br><span class="line">             &lt;td width=&quot;200px&quot; id=&quot;e3&quot; style=&quot;color:red;font-weight:bold&quot;&gt;&lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">             &lt;th colspan=<span class="string">&quot;3&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span>/&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;取消&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span>/&gt;</span><br><span class="line">             &lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">       &lt;/table&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">   <span class="function">function <span class="title">reCheck</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//获得当前表单对象</span></span><br><span class="line">      <span class="keyword">var</span> form1 = document.form1;</span><br><span class="line">      <span class="comment">//获得新密码</span></span><br><span class="line">      <span class="keyword">var</span> newpass = form1.newpass.value;</span><br><span class="line">      <span class="comment">//获得重复密码</span></span><br><span class="line">      <span class="keyword">var</span> repass = form1.repass.value;</span><br><span class="line">      <span class="comment">//错误信息提示位置</span></span><br><span class="line">      <span class="keyword">var</span> e3 = document.getElementById(<span class="string">&quot;e3&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(repass.length&lt;<span class="number">1</span>)&#123;</span><br><span class="line">         e3.innerText=<span class="string">&quot;请输入重复密码&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(repass != newpass)&#123;</span><br><span class="line">            e3.innerText=<span class="string">&quot;两次密码不一致&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e3.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="function">function <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//获得当前表单对象</span></span><br><span class="line">      <span class="keyword">var</span> form1 = document.form1;</span><br><span class="line">      <span class="comment">//获得原始密码</span></span><br><span class="line">      <span class="keyword">var</span> oldpass = form1.oldpass.value;</span><br><span class="line">      <span class="comment">//获得新密码</span></span><br><span class="line">      <span class="keyword">var</span> newpass = form1.newpass.value;</span><br><span class="line">      <span class="keyword">var</span> e1 = document.getElementById(<span class="string">&quot;e1&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> e2 = document.getElementById(<span class="string">&quot;e2&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> e3 = document.getElementById(<span class="string">&quot;e3&quot;</span>);</span><br><span class="line">      <span class="comment">//判断原始密码是否填写</span></span><br><span class="line">      <span class="keyword">if</span>(oldpass.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">         e1.innerText=<span class="string">&quot;请输入原始密码&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         e1.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//判断新密码是否填写</span></span><br><span class="line">      <span class="keyword">if</span>(newpass.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">         e2.innerText=<span class="string">&quot;请输入新密码&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         e2.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//验证重复密码</span></span><br><span class="line">      <span class="keyword">var</span> v = reCheck();</span><br><span class="line">      <span class="keyword">if</span>(v == <span class="keyword">false</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(oldpass == newpass)&#123;</span><br><span class="line">         e2.innerText = <span class="string">&quot;密码未被改变&quot;</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         e2.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      form1.action=<span class="string">&quot;/updatePwd&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>在web.xml中配置映射请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--UpdatePwdServlet修改密码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>updatePwd<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.user.UpdatePwdServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>updatePwd<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/updatePwd<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="7）运行测试，略"><a href="#7）运行测试，略" class="headerlink" title="7）运行测试，略"></a>7）运行测试，略</h4><h3 id="3-问答模块"><a href="#3-问答模块" class="headerlink" title="3. 问答模块"></a>3. 问答模块</h3><h4 id="1）★-新冠信息的爬取"><a href="#1）★-新冠信息的爬取" class="headerlink" title="1）★ 新冠信息的爬取"></a>1）★ 新冠信息的爬取</h4><p>这里我尝试过爬取百度知道有关新冠肺炎的知识信息，但由于其反爬机制较为强大并未成功，经过尝试后选择对搜狗问问进行爬取。</p>
<h5 id="1-分析网页"><a href="#1-分析网页" class="headerlink" title="1. 分析网页"></a>1. 分析网页</h5><ul>
<li>使用搜狗搜索关键词“<a target="_blank" rel="noopener" href="https://www.sogou.com/sogou?query=%E6%96%B0%E5%86%A0%E8%82%BA%E7%82%8E&insite=wenwen.sogou.com&pid=sogou-wsse-a9e18cb5dd9d3ab4&rcer=&page=2&ie=utf8">新冠肺炎</a>“，分析URL:</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.sogou.com/sogou?query=%E6%96%B0%E5%86%A0%E8%82%BA%E7%82%8E&amp;insite=wenwen.sogou.com&amp;pid=sogou-wsse-a9e18cb5dd9d3ab4&amp;rcer=&amp;page=1&amp;ie=utf8">https://www.sogou.com/sogou?query=%E6%96%B0%E5%86%A0%E8%82%BA%E7%82%8E&amp;insite=wenwen.sogou.com&amp;pid=sogou-wsse-a9e18cb5dd9d3ab4&amp;rcer=&amp;page=1&amp;ie=utf8</a></p>
<p>可以发现page=””表示页数，所以可以通过改变page后的参数来设置爬取的页数。</p>
<ul>
<li>通过按下F12查看网页源代码</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319163621089.png" alt="image-20210319163621089"></p>
<p>这些a标签中的href就是每个问答对的链接，通过Jsoup的select(“a[target=’_blank’]”)；可以爬去到这些href</p>
<ul>
<li>分析具体问答网页</li>
</ul>
<p>获取到上述链接后，对每一个链接进行访问，进入到详细的问答页面，同样F12查看网页源代码，找到问题和答案部分。</p>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319163920815.png" alt="image-20210319163920815"></p>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319164148235.png" alt="image-20210319164148235"></p>
<p>同样对他们的标签进行分析，使用Jsoup进行解析，代码见下文。</p>
<ul>
<li>字符处理</li>
</ul>
<p>可以看到网页源代码中的答案有许多无效字符，使用正则表达式进行无效字符的剔除即可。<br>问题字数较少，所以仅保留中文字符即可，正则表达式：replaceAll(“[ ^\ \u4E00 - \ \u9FA5] “,””)</p>
<p>针对答案的特殊字符，使用正则表达式：replaceAll(“[\ \u25c6~\ \u25c7]|[\ \——]|[\ \▲]|[\ \△]]”,””)</p>
<h5 id="2-编写HttpUtil工具类，负责获取HTML页面"><a href="#2-编写HttpUtil工具类，负责获取HTML页面" class="headerlink" title="2. 编写HttpUtil工具类，负责获取HTML页面"></a>2. 编写HttpUtil工具类，负责获取HTML页面</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.crawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PoolingHttpClientConnectionManager cm;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cm = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</span><br><span class="line">        <span class="comment">//设置最大连接数</span></span><br><span class="line">        <span class="keyword">this</span>.cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置每个主机的最大连接数</span></span><br><span class="line">        <span class="keyword">this</span>.cm.setDefaultMaxPerRoute(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据请求地址下载页面数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doGetHtml</span><span class="params">(String url)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1、获取HttpClient对象</span></span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(<span class="keyword">this</span>.cm).build();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2、创建HttpGet请求对象，设置url地址</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//設置httpGet的头部參數信息</span></span><br><span class="line">        httpGet.setHeader(<span class="string">&quot;User-Agent&quot;</span>,<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML,like Gecko) Chrome/74.0.3729.169 Safari/537.36&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、设置请求信息</span></span><br><span class="line">        httpGet.setConfig(<span class="keyword">this</span>.getConfig());</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//3、使用HttpClient发起请求，获取响应</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4、解析响应，返回结果</span></span><br><span class="line">            <span class="keyword">if</span>(response.getStatusLine().getStatusCode() == HttpStatus.SC_OK)&#123;</span><br><span class="line">                <span class="comment">//判断响应体Entity是否为空，若不为空则可以使用EntityUtils</span></span><br><span class="line">                <span class="keyword">if</span>(response.getEntity() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭response</span></span><br><span class="line">            <span class="keyword">if</span>(response != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RequestConfig <span class="title">getConfig</span><span class="params">()</span> </span>&#123;     </span><br><span class="line">        RequestConfig config = RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(<span class="number">20000</span>)    <span class="comment">//创建连接的最长时间</span></span><br><span class="line">                .setConnectionRequestTimeout(<span class="number">20000</span>)   <span class="comment">//获得连接的最长时间</span></span><br><span class="line">                .setSocketTimeout(<span class="number">10000</span>)    <span class="comment">//数据传输的最长时间</span></span><br><span class="line">                <span class="comment">//.setProxy(proxy)			//如果IP被封，考虑使用代理IP</span></span><br><span class="line">                <span class="comment">//.setCookieSpec(CookieSpecs.STANDARD)</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-编写Spider类，负责解析HTML页面，返回爬取结果"><a href="#3-编写Spider类，负责解析HTML页面，返回爬取结果" class="headerlink" title="3. 编写Spider类，负责解析HTML页面，返回爬取结果"></a>3. 编写Spider类，负责解析HTML页面，返回爬取结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.crawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//爬取搜狗问问页面的问答连接</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spider</span> </span>&#123;</span><br><span class="line">    <span class="comment">//存放搜索问题的url</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; hrefList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="comment">//hashMap存放问答</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; QAs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHref</span><span class="params">(<span class="keyword">int</span> page)</span></span>&#123;</span><br><span class="line">        HttpUtil httpUtil = <span class="keyword">new</span> HttpUtil();</span><br><span class="line">        <span class="comment">//搜索新冠肺炎url</span></span><br><span class="line">        String url = <span class="string">&quot;https://www.sogou.com/sogou?query=%E6%96%B0%E5%86%A0%E8%82%BA%E7%82%8E&amp;insite=wenwen.sogou.com&amp;pid=sogou-wsse-a9e18cb5dd9d3ab4&amp;rcer=&amp;page=&quot;</span>+page+<span class="string">&quot;&amp;ie=utf8&quot;</span>;</span><br><span class="line">        String html = httpUtil.doGetHtml(url);</span><br><span class="line">        <span class="comment">//System.out.println(html);</span></span><br><span class="line">        Document document= Jsoup.parse(html);</span><br><span class="line">        <span class="comment">//System.out.println(document);</span></span><br><span class="line">        Elements postItems = document.getElementsByClass(<span class="string">&quot;fb&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Element postItem : postItems)&#123;</span><br><span class="line">            Elements link=postItem.select(<span class="string">&quot;a[target=&#x27;_blank&#x27;]&quot;</span>);</span><br><span class="line">            <span class="comment">//System.out.println(link.attr(&quot;href&quot;));</span></span><br><span class="line">            hrefList.add(link.attr(<span class="string">&quot;href&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回一个数组，第一个元素为问题，第二个元素为答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getQuestionAndAnswer</span><span class="params">(String  url)</span></span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; temp = <span class="keyword">new</span> ArrayList&lt;&gt;();<span class="comment">//第一个元素存问题，第二个元素存答案</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//搜狗问问，搜索新冠肺炎url</span></span><br><span class="line">        HttpUtil httpUtil = <span class="keyword">new</span> HttpUtil();</span><br><span class="line">        String html = httpUtil.doGetHtml(url);</span><br><span class="line">        <span class="comment">//System.out.println(html);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析html页面</span></span><br><span class="line">        Document document = Jsoup.parse(html);</span><br><span class="line">        <span class="comment">//System.out.print(document.text());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得搜索的问题</span></span><br><span class="line">        Element title = document.getElementById(<span class="string">&quot;question_title&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(title != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//System.out.println(title.text());</span></span><br><span class="line">            String question = title.text().replaceAll(<span class="string">&quot;[^\\u4E00-\\u9FA5]&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">            temp.add(question);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得搜索的答案</span></span><br><span class="line">        Elements preTag = document.getElementsByTag(<span class="string">&quot;pre&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(preTag != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String answer = preTag.get(<span class="number">0</span>).text().replaceAll(<span class="string">&quot;[\\u25c6~\\u25c7]|[\\——]|[\\▲]|[\\△]]&quot;</span>,<span class="string">&quot;&quot;</span>).trim();</span><br><span class="line">            temp.add(answer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//爬取页号为Page的问题与答案</span></span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; spiderQuestionAndAnswer(<span class="keyword">int</span> page)&#123;</span><br><span class="line">        getHref(page);</span><br><span class="line">        <span class="keyword">for</span>(String href:hrefList)&#123;</span><br><span class="line">            QAs.add(getQuestionAndAnswer(href));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> QAs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-设置定时任务，实现定时爬取"><a href="#4-设置定时任务，实现定时爬取" class="headerlink" title="4. 设置定时任务，实现定时爬取"></a>4. 设置定时任务，实现定时爬取</h5><p>我尝试过一次爬取多个页面，当一次爬取5个页面时就会被反爬机制捕获，并将导致短时间内无法再次进行爬取，于是这里采用设置定时任务的方式，每隔固定时间爬取一个页面的数据存入数据库，从而避免了IP的封杀。</p>
<ul>
<li>建立一个TaskListener类，继承ServletContextListener，调用TimerManager类的默认构建方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.servlet.time;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.util.crawler.TimerManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> TimerManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在web.xml中设置任务监听器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--TaskListener 监听器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.zqy.servlet.time.TaskListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里引入常量类Constants，将频繁更改的固定数值放入其中，方便后续代码的优化。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String USER_SESSION = <span class="string">&quot;userSession&quot;</span>;    <span class="comment">//用户Session</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> page = <span class="number">13</span>;   <span class="comment">//爬取的页号</span></span><br><span class="line">    <span class="comment">//设置每天新冠疫情问答数据库更新时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> PERIOD_DAY = <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;      <span class="comment">//时间间隔1天</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> UPDATE_HOUR = <span class="number">13</span>;                       <span class="comment">//时</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> UPDATE_MINUTE = <span class="number">0</span>;                     <span class="comment">//分</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> UPDATE_SECOND = <span class="number">0</span>;                      <span class="comment">//秒</span></span><br><span class="line">    <span class="comment">//设置显示搜索问题的最佳答案数量（若无正确匹配问题，则显示bestAnsNum个最可能是答案的数据）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> bestAnsNum = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>定义TimerManager类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.crawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.util.Constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerManager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimerManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 设置每天新冠疫情问答数据库更新时间 */</span></span><br><span class="line">        calendar.set(Calendar.HOUR_OF_DAY, Constants.UPDATE_HOUR);</span><br><span class="line">        calendar.set(Calendar.MINUTE, Constants.UPDATE_MINUTE);</span><br><span class="line">        calendar.set(Calendar.SECOND, Constants.UPDATE_SECOND);</span><br><span class="line"></span><br><span class="line">        Date date=calendar.getTime(); <span class="comment">//第一次执行定时任务的时间</span></span><br><span class="line">        System.out.println(<span class="string">&quot;第一次执行定时任务的时间：&quot;</span>+date);</span><br><span class="line">        <span class="comment">//如果第一次执行定时任务的时间 &lt; 当前的时间</span></span><br><span class="line">        <span class="comment">//此时第一次执行定时任务的时间 + 1 day，以便此任务在下个时间点执行。如果不加一天，任务会立即执行。循环执行的周期则以当前时间为准</span></span><br><span class="line">        <span class="keyword">if</span> (date.before(<span class="keyword">new</span> Date())) &#123;</span><br><span class="line">            date = <span class="keyword">this</span>.addDay(date, <span class="number">1</span>);</span><br><span class="line">            System.out.println(date);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();</span><br><span class="line"></span><br><span class="line">        Task task = <span class="keyword">new</span> Task();</span><br><span class="line">        <span class="comment">//安排指定的任务在指定的时间开始进行重复的固定延迟执行。</span></span><br><span class="line">        timer.schedule(task,date,Constants.PERIOD_DAY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加或减少天数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">addDay</span><span class="params">(Date date, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        Calendar startDT = Calendar.getInstance();</span><br><span class="line">        startDT.setTime(date);</span><br><span class="line">        startDT.add(Calendar.DAY_OF_MONTH, num);</span><br><span class="line">        <span class="keyword">return</span> startDT.getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>定义一个任务类Task，用于执行定时任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.crawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.QAService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.impl.QAServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.util.Constants;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">//爬取新冠肺炎问答，写入数据库</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前爬取页号为：&quot;</span>+ Constants.page);</span><br><span class="line">        Spider spider = <span class="keyword">new</span> Spider();</span><br><span class="line">        ArrayList&lt;ArrayList&lt;String&gt;&gt; qaArray = spider.spiderQuestionAndAnswer(Constants.page);</span><br><span class="line">        <span class="comment">//更新页号</span></span><br><span class="line">        Constants.page += <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//调用业务层代码</span></span><br><span class="line">        QAService qaService = <span class="keyword">new</span> QAServiceImpl();</span><br><span class="line">        qaService.updateQA(qaArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-运行测试，略"><a href="#5-运行测试，略" class="headerlink" title="5. 运行测试，略"></a>5. 运行测试，略</h5><h4 id="2）QADao接口的编写"><a href="#2）QADao接口的编写" class="headerlink" title="2）QADao接口的编写"></a>2）QADao接口的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.dao.qa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.QA;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QADao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//存入问题-答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateQA</span><span class="params">(Connection conn, String question, String answer)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//根据问题，搜索答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getBestAns</span><span class="params">(Connection conn, String question)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//根据问题id，搜索答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAns</span><span class="params">(Connection conn, <span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//根据页面大小，获取页数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage</span><span class="params">(Connection connection, <span class="keyword">int</span> pageSize)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">    <span class="comment">//根据页面大小和当前页，获取对应的问题-答案列表</span></span><br><span class="line">    <span class="function">List&lt;QA&gt; <span class="title">findAllQA</span><span class="params">(Connection connection, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> currentPage)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3）接口实现类QADaoImpl的编写"><a href="#3）接口实现类QADaoImpl的编写" class="headerlink" title="3）接口实现类QADaoImpl的编写"></a>3）接口实现类QADaoImpl的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.dao.qa.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.BaseDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.qa.QADao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.QA;</span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.QAService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.impl.QAServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.util.Constants;</span><br><span class="line"><span class="keyword">import</span> com.zqy.util.textSimilarity.CosineSimilarity;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QADaoImpl</span> <span class="keyword">implements</span> <span class="title">QADao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateQA</span><span class="params">(Connection conn, String question, String answer)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;insert ignore into covid(question,answer,creationDate) VALUES (?,?,?)&quot;</span>;</span><br><span class="line">            pstm = conn.prepareStatement(sql);</span><br><span class="line">            pstm.setString(<span class="number">1</span>, question);</span><br><span class="line">            pstm.setString(<span class="number">2</span>, answer);</span><br><span class="line">            pstm.setTimestamp(<span class="number">3</span>, <span class="keyword">new</span> Timestamp(System.currentTimeMillis()));</span><br><span class="line">            <span class="keyword">if</span>(pstm.executeUpdate() == <span class="number">1</span>)&#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getBestAns</span><span class="params">(Connection conn, String question)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        ArrayList&lt;String&gt; ans = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;select * from covid&quot;</span>;</span><br><span class="line">            pstm = conn.prepareStatement(sql);</span><br><span class="line">            rs = pstm.executeQuery();</span><br><span class="line">            <span class="comment">//获取最高分</span></span><br><span class="line">            <span class="keyword">double</span> maxScore = <span class="number">0.0</span>;</span><br><span class="line">            <span class="comment">//满分</span></span><br><span class="line">            <span class="keyword">double</span> fullScore = <span class="number">1.0</span>;</span><br><span class="line">            <span class="keyword">long</span> fullScoreToLong = Double.doubleToLongBits(fullScore);</span><br><span class="line">            <span class="comment">//设置最佳答案数量</span></span><br><span class="line">            <span class="keyword">int</span> bestAnsNum = Constants.bestAnsNum;</span><br><span class="line">            List&lt;HashMap&lt;String,Object&gt;&gt; lst = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">                <span class="keyword">double</span> similarityScore = CosineSimilarity.getSimilarity(rs.getString(<span class="string">&quot;question&quot;</span>),question);</span><br><span class="line">                HashMap&lt;String,Object&gt; hm = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                hm.put(<span class="string">&quot;question&quot;</span>,rs.getString(<span class="string">&quot;question&quot;</span>));</span><br><span class="line">                hm.put(<span class="string">&quot;score&quot;</span>,similarityScore);</span><br><span class="line">                hm.put(<span class="string">&quot;id&quot;</span>,rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                lst.add(hm);</span><br><span class="line">            &#125;</span><br><span class="line">            lst.sort((o1, o2) -&gt; &#123;</span><br><span class="line">                <span class="keyword">long</span> score1 = Double.doubleToLongBits((Double) o1.get(<span class="string">&quot;score&quot;</span>));</span><br><span class="line">                <span class="keyword">long</span> score2 = Double.doubleToLongBits((Double) o2.get(<span class="string">&quot;score&quot;</span>));</span><br><span class="line">                <span class="keyword">if</span> (score1 &gt; score2) &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (score1 &lt; score2) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bestAnsNum; i++) &#123;</span><br><span class="line">                StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                sb.append(<span class="string">&quot;问题：&quot;</span>+lst.get(i).get(<span class="string">&quot;question&quot;</span>)+<span class="string">&quot;\n&quot;</span>);<span class="comment">//添加问题</span></span><br><span class="line">                sb.append(<span class="string">&quot;答案：&quot;</span>+getAns(conn, (Integer) lst.get(i).get(<span class="string">&quot;id&quot;</span>))+<span class="string">&#x27;\n&#x27;</span>);<span class="comment">//添加答案</span></span><br><span class="line">                sb.append(<span class="string">&quot;答案评分：&quot;</span>+lst.get(i).get(<span class="string">&quot;score&quot;</span>)+<span class="string">&quot;\n\n&quot;</span>);<span class="comment">//添加评分</span></span><br><span class="line">                ans.add(sb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAns</span><span class="params">(Connection conn, <span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        String ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;select answer from covid where id = ?&quot;</span>;</span><br><span class="line">            Object[] params = &#123;id&#125;;</span><br><span class="line">            rs = BaseDao.execute(conn,pstm,rs,sql,params);</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                ans = rs.getString(<span class="string">&quot;answer&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage</span><span class="params">(Connection conn, <span class="keyword">int</span> pageSize)</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> totalNum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> totalPage = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;select count(*) from covid&quot;</span>;</span><br><span class="line">            pstm = conn.prepareStatement(sql);</span><br><span class="line">            rs = pstm.executeQuery();</span><br><span class="line">            <span class="keyword">if</span> (rs.next())&#123;</span><br><span class="line">                totalNum = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(totalNum % pageSize == <span class="number">0</span>)&#123;</span><br><span class="line">                totalPage = totalNum / pageSize;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                totalPage = totalNum / pageSize + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;QA&gt; <span class="title">findAllQA</span><span class="params">(Connection conn, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> currentPage)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;QA&gt; qaList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String sql = <span class="string">&quot;select * from covid limit ?, ?&quot;</span>;</span><br><span class="line">            Object[] params = &#123;(currentPage-<span class="number">1</span>)*pageSize,pageSize&#125;;</span><br><span class="line">            rs = BaseDao.execute(conn,pstm,rs,sql,params);</span><br><span class="line">            <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">                QA qa = <span class="keyword">new</span> QA();</span><br><span class="line">                qa.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                qa.setQuestion(rs.getString(<span class="string">&quot;question&quot;</span>));</span><br><span class="line">                qa.setAnswer(rs.getString(<span class="string">&quot;answer&quot;</span>));</span><br><span class="line">                qaList.add(qa);</span><br><span class="line">            &#125;</span><br><span class="line">            BaseDao.closeResource(<span class="keyword">null</span>,pstm,rs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> qaList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4）QAService业务层接口的编写"><a href="#4）QAService业务层接口的编写" class="headerlink" title="4）QAService业务层接口的编写"></a>4）QAService业务层接口的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.service.qa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.QA;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QAService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一次更新多条数据，规定：传入参数为一个数组，数据元素仍为一个数组：第一个元素为问题，第二个元素为答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateQA</span><span class="params">(ArrayList&lt;ArrayList&lt;String&gt;&gt; qaArray)</span></span>;</span><br><span class="line">    <span class="comment">//根据问题，搜索答案</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getBestAns</span><span class="params">(String question)</span></span>;</span><br><span class="line">    <span class="comment">//根据页面大小，计算页数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage</span><span class="params">(<span class="keyword">int</span> pageSize)</span></span>;</span><br><span class="line">    <span class="comment">//根据页面大小和当前页，获取对应的问题-答案列表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;QA&gt; <span class="title">findAllQA</span><span class="params">(<span class="keyword">int</span> pageSize, <span class="keyword">int</span> currentPage)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5）接口实现类QAServiceImpl的编写"><a href="#5）接口实现类QAServiceImpl的编写" class="headerlink" title="5）接口实现类QAServiceImpl的编写"></a>5）接口实现类QAServiceImpl的编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.service.qa.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.BaseDao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.qa.QADao;</span><br><span class="line"><span class="keyword">import</span> com.zqy.dao.qa.impl.QADaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.QA;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.QAService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QAServiceImpl</span> <span class="keyword">implements</span> <span class="title">QAService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//引入Dao</span></span><br><span class="line">    <span class="keyword">private</span> QADao qaDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QAServiceImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        qaDao = <span class="keyword">new</span> QADaoImpl();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateQA</span><span class="params">(ArrayList&lt;ArrayList&lt;String&gt;&gt; qaArray)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; qaArray.size(); i++) &#123;</span><br><span class="line">                String question = qaArray.get(i).get(<span class="number">0</span>);</span><br><span class="line">                String answer = qaArray.get(i).get(<span class="number">1</span>);</span><br><span class="line">                flag = qaDao.updateQA(connection,question,answer);</span><br><span class="line">                <span class="keyword">if</span>(flag)&#123;<span class="comment">//若执行成功</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;已完成数据载入：&quot;</span>+(i+<span class="number">1</span>)+<span class="string">&quot; question:&quot;</span>+question);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getBestAns</span><span class="params">(String question)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        ArrayList&lt;String&gt; ans = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ans = qaDao.getBestAns(connection,question);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage</span><span class="params">(<span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        <span class="keyword">int</span> totalPage = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            totalPage = qaDao.getTotalPage(connection,pageSize);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;QA&gt; <span class="title">findAllQA</span><span class="params">(<span class="keyword">int</span> pageSize, <span class="keyword">int</span> currentPage)</span> </span>&#123;</span><br><span class="line">        Connection connection = BaseDao.getConn();</span><br><span class="line">        List&lt;QA&gt; qaList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//通过业务层调用对应的具体的数据库操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            qaList = qaDao.findAllQA(connection,pageSize,currentPage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            BaseDao.closeResource(connection,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> qaList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6）问答模块Servlet层的编写"><a href="#6）问答模块Servlet层的编写" class="headerlink" title="6）问答模块Servlet层的编写"></a>6）问答模块Servlet层的编写</h4><h5 id="1-SearchServlet的编写，负责处理用户的问题搜索请求（加入了自然语言处理，在数据库中进行问题的相似度匹配）"><a href="#1-SearchServlet的编写，负责处理用户的问题搜索请求（加入了自然语言处理，在数据库中进行问题的相似度匹配）" class="headerlink" title="1. SearchServlet的编写，负责处理用户的问题搜索请求（加入了自然语言处理，在数据库中进行问题的相似度匹配）"></a>1. SearchServlet的编写，负责处理用户的问题搜索请求（加入了自然语言处理，在数据库中进行问题的相似度匹配）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.servlet.qa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.QAService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.impl.QAServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.UserService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.user.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//Servlet：控制层、调用业务层代码</span></span><br><span class="line">        QAService qaService = <span class="keyword">new</span> QAServiceImpl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取前端输入的问题</span></span><br><span class="line">        String quesion = req.getParameter(<span class="string">&quot;question&quot;</span>);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;question&quot;</span>,quesion);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取最佳答案字符串数组，包括问题、答案、答案评分</span></span><br><span class="line">        ArrayList&lt;String&gt; bestAns = qaService.getBestAns(quesion);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//记录最高分数，用来输出提示信息</span></span><br><span class="line">        String score = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//页面前端显示答案：这里选择直接用字符串拼接的方式，输出一个大字符串</span></span><br><span class="line">        String showAns = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bestAns.size(); i++) &#123;</span><br><span class="line">            String qas = bestAns.get(i);<span class="comment">//存放：问题、答案、评分</span></span><br><span class="line">            sb.append(qas);</span><br><span class="line">            <span class="comment">//获取最高的评分</span></span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">                score = qas.substring(qas.toString().lastIndexOf(<span class="string">&quot;：&quot;</span>)+<span class="number">1</span>).trim();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(score!= <span class="keyword">null</span> &amp;&amp; score.equals(<span class="string">&quot;1.0&quot;</span>))&#123;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;已找到精确答案!&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;已找到近似答案!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        showAns = sb.toString();</span><br><span class="line">        req.setAttribute(<span class="string">&quot;answer&quot;</span>,showAns);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;search.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-ShowQAServlet的编写，负责向前端展示数据库的部分信息。"><a href="#2-ShowQAServlet的编写，负责向前端展示数据库的部分信息。" class="headerlink" title="2. ShowQAServlet的编写，负责向前端展示数据库的部分信息。"></a>2. ShowQAServlet的编写，负责向前端展示数据库的部分信息。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.servlet.qa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zqy.pojo.QA;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.QAService;</span><br><span class="line"><span class="keyword">import</span> com.zqy.service.qa.impl.QAServiceImpl;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShowQAServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String cp = req.getParameter(<span class="string">&quot;currentPage&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> currentPage = Integer.parseInt(cp);</span><br><span class="line">        <span class="keyword">if</span>(currentPage&lt;<span class="number">1</span>)&#123;</span><br><span class="line">            currentPage = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        QAService qaService = <span class="keyword">new</span> QAServiceImpl();</span><br><span class="line">        <span class="keyword">int</span> totalPage = qaService.getTotalPage(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currentPage&gt;totalPage)&#123;</span><br><span class="line">            currentPage = totalPage;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;QA&gt; qaList = qaService.findAllQA(<span class="number">10</span>, currentPage);</span><br><span class="line"></span><br><span class="line">        req.setAttribute(<span class="string">&quot;currentPage&quot;</span>, currentPage);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;totalPage&quot;</span>, totalPage);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;qaList&quot;</span>, qaList);</span><br><span class="line"></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;showQA.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-对应在web-xml文件中添加请求映射-1"><a href="#3-对应在web-xml文件中添加请求映射-1" class="headerlink" title="3. 对应在web.xml文件中添加请求映射"></a>3. 对应在web.xml文件中添加请求映射</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SearchServlet从数据库搜索问题--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SearchServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.qa.SearchServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SearchServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/search<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--显示数据库信息到页面中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ShowQAServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zqy.servlet.qa.ShowQAServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ShowQAServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/show<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="7）前端jsp页面代码"><a href="#7）前端jsp页面代码" class="headerlink" title="7）前端jsp页面代码"></a>7）前端jsp页面代码</h4><h5 id="1-main-jsp"><a href="#1-main-jsp" class="headerlink" title="1. main.jsp"></a>1. main.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;My JSP &#x27;main.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;frameset rows=<span class="string">&quot;25%,*&quot;</span> border=<span class="string">&quot;5px&quot;</span> bordercolor=<span class="string">&quot;black&quot;</span> frameborder=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">   &lt;frame src=<span class="string">&quot;top.jsp&quot;</span> name=<span class="string">&quot;top&quot;</span> noresize scrolling=<span class="string">&quot;no&quot;</span>/&gt;</span><br><span class="line">   &lt;frameset cols=<span class="string">&quot;15%,*&quot;</span>&gt;</span><br><span class="line">      &lt;frame src=<span class="string">&quot;left.jsp&quot;</span> name=<span class="string">&quot;left&quot;</span> noresize/&gt;</span><br><span class="line">      &lt;frame src=<span class="string">&quot;updatePassword.jsp&quot;</span> name=<span class="string">&quot;right&quot;</span>/&gt;</span><br><span class="line">   &lt;/frameset&gt;</span><br><span class="line">  &lt;/frameset&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-left-jsp"><a href="#2-left-jsp" class="headerlink" title="2. left.jsp"></a>2. left.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt; </span><br><span class="line">    &lt;title&gt;My JSP &#x27;left.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">   ul&#123;</span><br><span class="line">      list-style-type:none;</span><br><span class="line">      &lt;!--background-color:#1D9BE7;--&gt;</span><br><span class="line">      border:2px solid purple;</span><br><span class="line">      width:120px;</span><br><span class="line">      height:240px;</span><br><span class="line">   &#125;</span><br><span class="line">   ul li&#123;</span><br><span class="line">      padding:15px;</span><br><span class="line">   &#125;</span><br><span class="line">   a&#123;</span><br><span class="line">      text-decoration: none;</span><br><span class="line">      color:black;</span><br><span class="line">   &#125;</span><br><span class="line">   a:HOVER &#123;</span><br><span class="line">      text-decoration:underline;</span><br><span class="line">      color:red;</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;body bgcolor=<span class="string">&quot;#ffdead&quot;</span>&gt;</span><br><span class="line">       &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href=&quot;search.jsp&quot; target=&quot;right&quot;&gt;问题搜索&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=&quot;show?currentPage=1&quot; target=&quot;right&quot;&gt;常见问题&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href=&quot;updatePassword.jsp&quot; target=&quot;right&quot;&gt;密码修改&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href=&quot;https://coderzqy.github.io/&quot; target=&quot;main&quot;&gt;友情链接&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;a href=&quot;javascript:void(0)&quot;&gt;帮助&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">       &lt;/ul&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="3-top-jsp"><a href="#3-top-jsp" class="headerlink" title="3. top.jsp"></a>3. top.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt; </span><br><span class="line">    &lt;title&gt;My JSP &#x27;top.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">   h1&#123;</span><br><span class="line">      font-size:45px;</span><br><span class="line">      font-family:华文行楷;</span><br><span class="line">      color:black</span><br><span class="line">   &#125;</span><br><span class="line">   #time&#123;</span><br><span class="line">      position:absolute;</span><br><span class="line">      left:<span class="number">75</span>%;</span><br><span class="line">   &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;body bgcolor=<span class="string">&quot;#ffdead&quot;</span> onload=<span class="string">&quot;getNowTime()&quot;</span>&gt;</span><br><span class="line">    &lt;div style=&quot;text-align: center;&quot;&gt;&lt;h1&gt;新冠肺炎知识与防护自动问答系统&lt;br&gt;(COVID-19 Intelligent QA System)&lt;/h1&gt;&lt;/div&gt;</span><br><span class="line">    &lt;span style=&quot;text-indent:3cm&quot;&gt;欢迎你，$&#123;userSession.userName&#125;&lt;/span&gt;</span><br><span class="line">    &lt;span id=&quot;time&quot;&gt;当前时间: &lt;span id=&quot;nowtime&quot;&gt;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;javascript:window.location.replace(&#x27;loginAndRegister.jsp&#x27;)&quot; target=&quot;_top&quot;&gt;退出系统&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">      <span class="function">function <span class="title">getNowTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="comment">//获得显示时间的位置</span></span><br><span class="line">         <span class="keyword">var</span> showtime = document.getElementById(<span class="string">&quot;nowtime&quot;</span>);</span><br><span class="line">         <span class="comment">//获取当前系统时间</span></span><br><span class="line">         <span class="keyword">var</span> date = <span class="keyword">new</span> Date();</span><br><span class="line">         <span class="comment">//获取年月日时分秒</span></span><br><span class="line">         <span class="keyword">var</span> year = date.getFullYear();</span><br><span class="line">         <span class="keyword">var</span> month = date.getMonth()+<span class="number">1</span>;</span><br><span class="line">         <span class="keyword">if</span>(month.toString().length  &lt; <span class="number">2</span>)&#123;</span><br><span class="line">            month = <span class="string">&quot;0&quot;</span>+month;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> day = date.getDate();</span><br><span class="line">         <span class="keyword">if</span>(day.toString().length  &lt; <span class="number">2</span>)&#123;</span><br><span class="line">            day = <span class="string">&quot;0&quot;</span>+day;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> hour = date.getHours();</span><br><span class="line">         <span class="keyword">if</span>(hour.toString().length  &lt; <span class="number">2</span>)&#123;</span><br><span class="line">            hour = <span class="string">&quot;0&quot;</span>+hour;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> minu = date.getMinutes();</span><br><span class="line">         <span class="keyword">if</span>(minu.toString().length &lt; <span class="number">2</span>)&#123;</span><br><span class="line">            minu = <span class="string">&quot;0&quot;</span>+minu;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> second = date.getSeconds();</span><br><span class="line">         <span class="keyword">if</span>(second.toString().length &lt;<span class="number">2</span>)&#123;</span><br><span class="line">            second = <span class="string">&quot;0&quot;</span>+second;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> nowtime = year+<span class="string">&quot;/&quot;</span>+month+<span class="string">&quot;/&quot;</span>+day+<span class="string">&quot; &quot;</span>+hour+<span class="string">&quot;:&quot;</span>+minu+<span class="string">&quot;:&quot;</span>+second;</span><br><span class="line">         showtime.innerHTML=<span class="string">&quot;&lt;font color=&#x27;black&#x27;&gt;&quot;</span>+nowtime+<span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">         window.setTimeout(<span class="string">&quot;getNowTime()&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="4-search-jsp"><a href="#4-search-jsp" class="headerlink" title="4. search.jsp"></a>4. search.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=utf-8&quot;</span> pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;My JSP &#x27;updatePassword.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .input&#123;</span><br><span class="line">        height:30px;</span><br><span class="line">        width:600px;</span><br><span class="line">        font-size:20px;</span><br><span class="line">        align:<span class="string">&quot;center&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    .btn&#123;</span><br><span class="line">        cursor:pointer;</span><br><span class="line">        height:30px;</span><br><span class="line">        width:70px;</span><br><span class="line">        font-size:20px;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">        border:<span class="number">0</span>;</span><br><span class="line">        background-color: green;</span><br><span class="line">        color:white;</span><br><span class="line">    &#125;</span><br><span class="line">    .boxes&#123;</span><br><span class="line">        font-size:18px;</span><br><span class="line">        color:rebeccapurple;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;body bgcolor=<span class="string">&quot;#f5f5f5&quot;</span>&gt;</span><br><span class="line">&lt;form onsubmit=<span class="string">&quot;return check()&quot;</span> name=<span class="string">&quot;form1&quot;</span>&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th colspan=&quot;2&quot; style=&quot;font-size:25;font-style: oblique&quot;&gt;新冠肺炎知识搜索&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th colspan=&quot;2&quot; style=&quot;color:red&quot;&gt;$&#123;flag&#125;&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;question&quot; class=&quot;input&quot; value=&quot;$&#123;question&#125;&quot;&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;搜索&quot; class=&quot;btn&quot;/&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td width=&quot;200px&quot; id=&quot;e1&quot; style=&quot;color:red;font-weight:bold&quot;&gt;$&#123;error&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;textarea rows=&quot;20&quot; cols=&quot;120&quot; readonly=&quot;readonly&quot; class=&quot;boxes&quot;&gt;$&#123;answer&#125;&lt;/textarea&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function">function <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获得当前表单对象</span></span><br><span class="line">        <span class="keyword">var</span> form1 = document.form1;</span><br><span class="line">        <span class="comment">//获得问题</span></span><br><span class="line">        <span class="keyword">var</span> question = form1.question.value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> e1 = document.getElementById(<span class="string">&quot;e1&quot;</span>);</span><br><span class="line">        <span class="comment">//判断问题是否填写</span></span><br><span class="line">        <span class="keyword">if</span>(question.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            e1.innerText=<span class="string">&quot;问题不能为空&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e1.innerText=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        form1.action=<span class="string">&quot;/search&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="5-showQA-jsp"><a href="#5-showQA-jsp" class="headerlink" title="5. showQA.jsp"></a>5. showQA.jsp</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;My JSP &#x27;showQA.jsp.jsp&#x27; starting page&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body bgcolor=<span class="string">&quot;#f5f5f5&quot;</span>&gt;</span><br><span class="line">        &lt;form&gt;</span><br><span class="line">            &lt;table border=<span class="string">&quot;1&quot;</span> cellpadding=<span class="string">&quot;0&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> bordercolor=<span class="string">&quot;black&quot;</span> width=<span class="string">&quot;800px&quot;</span>&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th colspan=&quot;5&quot;&gt;新冠知识数据库信息&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;问题&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;答案&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">&quot;$&#123;qaList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;qa&quot;</span>&gt;</span><br><span class="line">                    &lt;tr onmouseover=<span class="string">&quot;this.bgColor=&#x27;lightblue&#x27;&quot;</span> onmouseout=<span class="string">&quot;this.bgColor=&#x27;&#x27;&quot;</span> style=<span class="string">&quot;cursor:pointer&quot;</span>&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;qa.id&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;qa.question&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;$&#123;qa.answer&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;/tr&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td align=<span class="string">&quot;right&quot;</span> colspan=<span class="string">&quot;5&quot;</span>&gt;</span><br><span class="line">                        &lt;a href=&quot;show?currentPage=1&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;show?currentPage=$&#123;currentPage-1&#125;&quot;&gt;上一页&lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;show?currentPage=$&#123;currentPage+1&#125;&quot;&gt;下一页&lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;show?currentPage=$&#123;totalPage&#125;&quot;&gt;尾页&lt;/a&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<h4 id="8）自然语言处理（NLP）"><a href="#8）自然语言处理（NLP）" class="headerlink" title="8）自然语言处理（NLP）"></a>8）自然语言处理（NLP）</h4><p>采用余弦相似度计算字符串相似度的方式，将用户输入的问题和数据库中已有的问题进行匹配，本系统选择将相似度最高的三个可能答案作为最佳答案返回，输出到前端显示。</p>
<h5 id="1-理论知识"><a href="#1-理论知识" class="headerlink" title="1. 理论知识"></a>1. 理论知识</h5><p>核心公式：</p>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319181142222.png" alt="image-20210319181142222"></p>
<p>余弦值越接近1，也就是两个向量越相似，这就叫”余弦相似性”，<br>余弦值越接近0，也就是两个向量越不相似，也就是这两个字符串越不相似。</p>
<h5 id="2-计算过程示例"><a href="#2-计算过程示例" class="headerlink" title="2. 计算过程示例"></a>2. 计算过程示例</h5><p>举一个例子来说明，用上述理论计算文本的相似性。为了简单起见，先从句子着手。</p>
<p><strong>句子A</strong>：这只皮靴号码大了。那只号码合适。</p>
<p><strong>句子B</strong>：这只皮靴号码不小，那只更合适。</p>
<p>怎样计算上面两句话的相似程度？</p>
<p>基本思路是：如果这两句话的用词越相似，它们的内容就应该越相似。因此，可以从词频入手，计算它们的相似程度。</p>
<p><strong>第一步：分词</strong></p>
<p>句子A：这只/皮靴/号码/大了。那只/号码/合适。</p>
<p>句子B：这只/皮靴/号码/不/小，那只/更/合适。</p>
<p><strong>第二步：计算词频</strong>（也就是每个词语出现的频率）</p>
<p>句子A：这只1，皮靴1，号码2，大了1。那只1，合适1，不0，小0，更0</p>
<p>句子B：这只1，皮靴1，号码1，大了0。那只1，合适1，不1，小1，更1</p>
<p><strong>第三步：写出词频向量</strong></p>
<p>　　句子A：(1，1，2，1，1，1，0，0，0)</p>
<p>　　句子B：(1，1，1，0，1，1，1，1，1)</p>
<p><strong>第四步：计算cos值</strong></p>
<p><img src="/2021/03/19/COVID-19-QA-System/1090617-20180815214345288-1095555724.png" alt="img"></p>
<p>计算结果中夹角的余弦值为0.81非常接近于1，所以，上面的句子A和句子B是基本相似的</p>
<h5 id="3-代码编写"><a href="#3-代码编写" class="headerlink" title="3. 代码编写"></a>3. 代码编写</h5><ul>
<li>用到的jar包（maven依赖）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--结合操作工具包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--bean实体注解工具包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--汉语言包，主要用于分词--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hankcs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hanlp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>portable-1.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--用于集合操作--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>分词工具类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.textSimilarity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hankcs.hanlp.HanLP;</span><br><span class="line"><span class="keyword">import</span> com.hankcs.hanlp.seg.common.Term;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**中文分词工具类*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tokenizer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**分词*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Word&gt; <span class="title">segment</span><span class="params">(String sentence)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1、 采用HanLP中文自然语言处理中标准分词进行分词</span></span><br><span class="line">        List&lt;Term&gt; termList = HanLP.segment(sentence);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上面控制台打印信息就是这里输出的</span></span><br><span class="line">        <span class="comment">//System.out.println(termList.toString());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、重新封装到Word对象中（term.word代表分词后的词语，term.nature代表改词的词性）</span></span><br><span class="line">        <span class="keyword">return</span> termList.stream().map(term -&gt; <span class="keyword">new</span> Word(term.word, term.nature.toString())).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Word类用于封装分词结果</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.textSimilarity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**封装分词结果*/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span> <span class="keyword">implements</span> <span class="title">Comparable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 词名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// 词性</span></span><br><span class="line">    <span class="keyword">private</span> String pos;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 权重，用于词向量分析</span></span><br><span class="line">    <span class="keyword">private</span> Float weight;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPos</span><span class="params">(String pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pos = pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Float <span class="title">getWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWeight</span><span class="params">(Float weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Word</span><span class="params">(String name, String pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.pos = pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> Word other = (Word) obj;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(<span class="keyword">this</span>.name, other.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">if</span> (name != <span class="keyword">null</span>) &#123;</span><br><span class="line">            str.append(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pos != <span class="keyword">null</span>) &#123;</span><br><span class="line">            str.append(<span class="string">&quot;/&quot;</span>).append(pos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.name == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Word)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String t = ((Word) o).getName();</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name.compareTo(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编写相似率具体实现工具类CosineSimilarity</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.textSimilarity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判定方式：余弦相似度，通过计算两个向量的夹角余弦值来评估他们的相似度 余弦夹角原理： 向量a=(x1,y1),向量b=(x2,y2) similarity=a.b/|a|*|b| a.b=x1x2+y1y2</span></span><br><span class="line"><span class="comment"> * |a|=根号[(x1)^2+(y1)^2],|b|=根号[(x2)^2+(y2)^2]*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CosineSimilarity</span> </span>&#123;</span><br><span class="line">    <span class="comment">//protected static final Logger LOGGER = LoggerFactory.getLogger(CosineSimilarity.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1、计算两个字符串的相似度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getSimilarity</span><span class="params">(String text1, String text2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果为空，或者字符长度为0，则代表完全相同</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text1) &amp;&amp; StringUtils.isBlank(text2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果一个为0或者空，一个不为，那说明完全不相似</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text1) || StringUtils.isBlank(text2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这个代表如果两个字符串相等那当然返回1了（这个我为了让它也分词计算一下，所以注释掉了）</span></span><br><span class="line">        <span class="keyword">if</span> (text1.equalsIgnoreCase(text2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//第一步：进行分词</span></span><br><span class="line">        List&lt;Word&gt; words1 = Tokenizer.segment(text1);</span><br><span class="line">        List&lt;Word&gt; words2 = Tokenizer.segment(text2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSimilarity(words1, words2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2、对于计算出的相似度保留小数点后六位</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getSimilarity</span><span class="params">(List&lt;Word&gt; words1, List&lt;Word&gt; words2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> score = getSimilarityImpl(words1, words2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//(int) (score * 1000000 + 0.5)其实代表保留小数点后六位 ,因为1034234.213强制转换不就是1034234。对于强制转换添加0.5就等于四舍五入</span></span><br><span class="line">        score = (<span class="keyword">int</span>) (score * <span class="number">1000000</span> + <span class="number">0.5</span>) / (<span class="keyword">double</span>) <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本相似度计算 判定方式：余弦相似度，通过计算两个向量的夹角余弦值来评估他们的相似度 余弦夹角原理： 向量a=(x1,y1),向量b=(x2,y2) similarity=a.b/|a|*|b| a.b=x1x2+y1y2</span></span><br><span class="line"><span class="comment">     * |a|=根号[(x1)^2+(y1)^2],|b|=根号[(x2)^2+(y2)^2]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getSimilarityImpl</span><span class="params">(List&lt;Word&gt; words1, List&lt;Word&gt; words2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 向每一个Word对象的属性都注入weight（权重）属性值</span></span><br><span class="line">        taggingWeightByFrequency(words1, words2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二步：计算词频</span></span><br><span class="line">        <span class="comment">//通过上一步让每个Word对象都有权重值，那么在封装到map中（key是词，value是该词出现的次数（即权重））</span></span><br><span class="line">        Map&lt;String, Float&gt; weightMap1 = getFastSearchMap(words1);</span><br><span class="line">        Map&lt;String, Float&gt; weightMap2 = getFastSearchMap(words2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将所有词都装入set容器中</span></span><br><span class="line">        Set&lt;Word&gt; words = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        words.addAll(words1);</span><br><span class="line">        words.addAll(words2);</span><br><span class="line"></span><br><span class="line">        AtomicFloat ab = <span class="keyword">new</span> AtomicFloat();<span class="comment">// a.b</span></span><br><span class="line">        AtomicFloat aa = <span class="keyword">new</span> AtomicFloat();<span class="comment">// |a|的平方</span></span><br><span class="line">        AtomicFloat bb = <span class="keyword">new</span> AtomicFloat();<span class="comment">// |b|的平方</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三步：写出词频向量，后进行计算</span></span><br><span class="line">        words.parallelStream().forEach(word -&gt; &#123;</span><br><span class="line">            <span class="comment">//看同一词在a、b两个集合出现的此次</span></span><br><span class="line">            Float x1 = weightMap1.get(word.getName());</span><br><span class="line">            Float x2 = weightMap2.get(word.getName());</span><br><span class="line">            <span class="keyword">if</span> (x1 != <span class="keyword">null</span> &amp;&amp; x2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//x1x2</span></span><br><span class="line">                <span class="keyword">float</span> oneOfTheDimension = x1 * x2;</span><br><span class="line">                <span class="comment">//+</span></span><br><span class="line">                ab.addAndGet(oneOfTheDimension);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (x1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//(x1)^2</span></span><br><span class="line">                <span class="keyword">float</span> oneOfTheDimension = x1 * x1;</span><br><span class="line">                <span class="comment">//+</span></span><br><span class="line">                aa.addAndGet(oneOfTheDimension);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (x2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//(x2)^2</span></span><br><span class="line">                <span class="keyword">float</span> oneOfTheDimension = x2 * x2;</span><br><span class="line">                <span class="comment">//+</span></span><br><span class="line">                bb.addAndGet(oneOfTheDimension);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//|a| 对aa开方</span></span><br><span class="line">        <span class="keyword">double</span> aaa = Math.sqrt(aa.doubleValue());</span><br><span class="line">        <span class="comment">//|b| 对bb开方</span></span><br><span class="line">        <span class="keyword">double</span> bbb = Math.sqrt(bb.doubleValue());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用BigDecimal保证精确计算浮点数</span></span><br><span class="line">        <span class="comment">//double aabb = aaa * bbb;</span></span><br><span class="line">        BigDecimal aabb = BigDecimal.valueOf(aaa).multiply(BigDecimal.valueOf(bbb));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//similarity=a.b/|a|*|b|</span></span><br><span class="line">        <span class="comment">//divide参数说明：aabb被除数,9表示小数点后保留9位，最后一个表示用标准的四舍五入法</span></span><br><span class="line">        <span class="keyword">double</span> cos = BigDecimal.valueOf(ab.get()).divide(aabb, <span class="number">9</span>, BigDecimal.ROUND_HALF_UP).doubleValue();</span><br><span class="line">        <span class="keyword">return</span> cos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向每一个Word对象的属性都注入weight（权重）属性值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">taggingWeightByFrequency</span><span class="params">(List&lt;Word&gt; words1, List&lt;Word&gt; words2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (words1.get(<span class="number">0</span>).getWeight() != <span class="keyword">null</span> &amp;&amp; words2.get(<span class="number">0</span>).getWeight() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//词频统计（key是词，value是该词在这段句子中出现的次数）</span></span><br><span class="line">        Map&lt;String, AtomicInteger&gt; frequency1 = getFrequency(words1);</span><br><span class="line">        Map&lt;String, AtomicInteger&gt; frequency2 = getFrequency(words2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是DEBUG模式输出词频统计信息</span></span><br><span class="line"><span class="comment">//        if (LOGGER.isDebugEnabled()) &#123;</span></span><br><span class="line"><span class="comment">//            LOGGER.debug(&quot;词频统计1：\n&#123;&#125;&quot;, getWordsFrequencyString(frequency1));</span></span><br><span class="line"><span class="comment">//            LOGGER.debug(&quot;词频统计2：\n&#123;&#125;&quot;, getWordsFrequencyString(frequency2));</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">// 标注权重（该词出现的次数）</span></span><br><span class="line">        words1.parallelStream().forEach(word -&gt; word.setWeight(frequency1.get(word.getName()).floatValue()));</span><br><span class="line">        words2.parallelStream().forEach(word -&gt; word.setWeight(frequency2.get(word.getName()).floatValue()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统计词频</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 词频统计图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, AtomicInteger&gt; <span class="title">getFrequency</span><span class="params">(List&lt;Word&gt; words)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, AtomicInteger&gt; freq = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//这步很帅哦</span></span><br><span class="line">        words.forEach(i -&gt; freq.computeIfAbsent(i.getName(), k -&gt; <span class="keyword">new</span> AtomicInteger()).incrementAndGet());</span><br><span class="line">        <span class="keyword">return</span> freq;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出：词频统计信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getWordsFrequencyString</span><span class="params">(Map&lt;String, AtomicInteger&gt; frequency)</span> </span>&#123;</span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">if</span> (frequency != <span class="keyword">null</span> &amp;&amp; !frequency.isEmpty()) &#123;</span><br><span class="line">            AtomicInteger integer = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">            frequency.entrySet().stream().sorted((a, b) -&gt; b.getValue().get() - a.getValue().get()).forEach(</span><br><span class="line">                    i -&gt; str.append(<span class="string">&quot;\t&quot;</span>).append(integer.incrementAndGet()).append(<span class="string">&quot;、&quot;</span>).append(i.getKey()).append(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">                            .append(i.getValue()).append(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        str.setLength(str.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造权重快速搜索容器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> Map&lt;String, Float&gt; <span class="title">getFastSearchMap</span><span class="params">(List&lt;Word&gt; words)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(words)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;String, Float&gt; weightMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(words.size());</span><br><span class="line"></span><br><span class="line">        words.parallelStream().forEach(i -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (i.getWeight() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                weightMap.put(i.getName(), i.getWeight());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;no word weight info:&quot;</span> + i.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> weightMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>AtomicFloat原子类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zqy.util.textSimilarity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> 张庆洋</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span> 2021/3/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicFloat</span> <span class="keyword">extends</span> <span class="title">Number</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger bits;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicFloat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicFloat</span><span class="params">(<span class="keyword">float</span> initialValue)</span> </span>&#123;</span><br><span class="line">        bits = <span class="keyword">new</span> AtomicInteger(Float.floatToIntBits(initialValue));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//叠加</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">addAndGet</span><span class="params">(<span class="keyword">float</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> expect;</span><br><span class="line">        <span class="keyword">float</span> update;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            expect = get();</span><br><span class="line">            update = expect + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!<span class="keyword">this</span>.compareAndSet(expect, update));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> update;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getAndAdd</span><span class="params">(<span class="keyword">float</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> expect;</span><br><span class="line">        <span class="keyword">float</span> update;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            expect = get();</span><br><span class="line">            update = expect + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!<span class="keyword">this</span>.compareAndSet(expect, update));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> expect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getAndDecrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">decrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addAndGet(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addAndGet(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getAndSet</span><span class="params">(<span class="keyword">float</span> newValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> expect;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            expect = get();</span><br><span class="line">        &#125; <span class="keyword">while</span> (!<span class="keyword">this</span>.compareAndSet(expect, newValue));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> expect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">float</span> expect, <span class="keyword">float</span> update)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bits.compareAndSet(Float.floatToIntBits(expect), Float.floatToIntBits(update));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">float</span> newValue)</span> </span>&#123;</span><br><span class="line">        bits.set(Float.floatToIntBits(newValue));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Float.intBitsToFloat(bits.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">floatValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">doubleValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">double</span>) floatValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">longValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">long</span>) get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Float.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>简要总结</li>
</ul>
<p> <strong>（1）先分词：</strong> 这里通过采用HanLP中文自然语言处理中标准分词进行分词。 </p>
<p> <strong>（2）统计词频：</strong> 就统计上面词出现的次数。</p>
<p> <strong>（3）通过每一个词出现的次数，变成一个向量，通过向量公式计算相似率。</strong></p>
<h4 id="9）运行测试，略"><a href="#9）运行测试，略" class="headerlink" title="9）运行测试，略"></a>9）运行测试，略</h4><h2 id="3、系统界面"><a href="#3、系统界面" class="headerlink" title="3、系统界面"></a>3、系统界面</h2><ul>
<li>主界面：</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319201612853.png" alt="image-20210319201612853"></p>
<ul>
<li>问题搜索</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319201715863.png" alt="image-20210319201715863"></p>
<ul>
<li>常见问题</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319201753125.png" alt="image-20210319201753125"></p>
<ul>
<li>密码修改界面</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319201812105.png" alt="image-20210319201812105"></p>
<ul>
<li>问答数据库部分展示</li>
</ul>
<p><img src="/2021/03/19/COVID-19-QA-System/image-20210319201852152.png" alt="image-20210319201852152"></p>

    </div>
    
    
    

    <div>
    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

    
    </div>
        <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="君莫良 支付宝">
        <p>支付宝</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="君莫良 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>君莫良
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/" title="COVID-19_QA_System">http://coderzqy.github.io/2021/03/19/COVID-19-QA-System/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/java%E7%88%AC%E8%99%AB/" rel="tag"># java爬虫</a>
              <a href="/tags/%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/" rel="tag"># 问答系统</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/03/18/lexical-analyzer/" rel="prev" title="lexical_analyzer">
      <i class="fa fa-chevron-left"></i> lexical_analyzer
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/03/30/finite-automaton/" rel="next" title="finite_automaton">
      finite_automaton <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JavaWeb-%E6%96%B0%E5%86%A0%E8%82%BA%E7%82%8E%E7%9F%A5%E8%AF%86%E4%B8%8E%E9%98%B2%E6%8A%A4%E8%87%AA%E5%8A%A8%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.</span> <span class="nav-text">JavaWeb 新冠肺炎知识与防护自动问答系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E8%AF%BE%E8%AE%BE%E8%AF%B4%E6%98%8E"><span class="nav-number">1.1.</span> <span class="nav-text">1、课设说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%B3%BB%E7%BB%9F%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. 系统主要功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.2.</span> <span class="nav-text">2、系统实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. 准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E5%AF%BC%E5%85%A5%E6%89%80%E9%9C%80%E7%9A%84maven%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">1）导入所需的maven依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89%E7%BC%96%E5%86%99%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%91%BD%E5%90%8D%E4%B8%BAdb-properties"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">2）编写连接数据库的配置文件，命名为db.properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E7%BC%96%E5%86%99%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%85%AC%E5%85%B1%E7%B1%BBBaseDao"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">3）编写操作数据库的公共类BaseDao</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">4）表设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E4%B8%BB%E7%B1%BBUser%E3%80%81QA%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.1.5.</span> <span class="nav-text">5) 主类User、QA的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%89%E7%BC%96%E5%86%99CharacterEncodingFilter%EF%BC%88%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%89%E7%B1%BB"><span class="nav-number">1.2.1.6.</span> <span class="nav-text">6）编写CharacterEncodingFilter（字符编码过滤器）类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 用户模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89UserDao%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">1）UserDao接口的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BBUserDaoImpl%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2）接口实现类UserDaoImpl的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89UserService%E4%B8%9A%E5%8A%A1%E5%B1%82%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">3）UserService业务层接口的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BBUserServiceImpl%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">4）接口实现类UserServiceImpl的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%89%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97Servlet%E5%B1%82%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">5）用户模块Servlet层的编写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-LoginServlet%E7%9A%84%E7%BC%96%E5%86%99%EF%BC%8C%E8%B4%9F%E8%B4%A3%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E7%9A%84%E6%B3%A8%E5%86%8C%E3%80%81%E7%99%BB%E5%BD%95"><span class="nav-number">1.2.2.5.1.</span> <span class="nav-text">1. LoginServlet的编写，负责处理用户的注册、登录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-UpdatePwdServlet%E7%9A%84%E7%BC%96%E5%86%99%EF%BC%8C%E8%B4%9F%E8%B4%A3%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="nav-number">1.2.2.5.2.</span> <span class="nav-text">2. UpdatePwdServlet的编写，负责处理用户修改密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%AF%B9%E5%BA%94%E5%9C%A8web-xml%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.2.5.3.</span> <span class="nav-text">3. 对应在web.xml文件中添加请求映射</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%89%E5%89%8D%E7%AB%AFjsp%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">6）前端jsp页面代码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-loginAndRegister-jsp"><span class="nav-number">1.2.2.6.1.</span> <span class="nav-text">1. loginAndRegister.jsp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-updatePassword-jsp"><span class="nav-number">1.2.2.6.2.</span> <span class="nav-text">2. updatePassword.jsp</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%EF%BC%89%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E7%95%A5"><span class="nav-number">1.2.2.7.</span> <span class="nav-text">7）运行测试，略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%97%AE%E7%AD%94%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 问答模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E2%98%85-%E6%96%B0%E5%86%A0%E4%BF%A1%E6%81%AF%E7%9A%84%E7%88%AC%E5%8F%96"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">1）★ 新冠信息的爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%86%E6%9E%90%E7%BD%91%E9%A1%B5"><span class="nav-number">1.2.3.1.1.</span> <span class="nav-text">1. 分析网页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E7%BC%96%E5%86%99HttpUtil%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%8C%E8%B4%9F%E8%B4%A3%E8%8E%B7%E5%8F%96HTML%E9%A1%B5%E9%9D%A2"><span class="nav-number">1.2.3.1.2.</span> <span class="nav-text">2. 编写HttpUtil工具类，负责获取HTML页面</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E7%BC%96%E5%86%99Spider%E7%B1%BB%EF%BC%8C%E8%B4%9F%E8%B4%A3%E8%A7%A3%E6%9E%90HTML%E9%A1%B5%E9%9D%A2%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%88%AC%E5%8F%96%E7%BB%93%E6%9E%9C"><span class="nav-number">1.2.3.1.3.</span> <span class="nav-text">3. 编写Spider类，负责解析HTML页面，返回爬取结果</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E7%88%AC%E5%8F%96"><span class="nav-number">1.2.3.1.4.</span> <span class="nav-text">4. 设置定时任务，实现定时爬取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E7%95%A5"><span class="nav-number">1.2.3.1.5.</span> <span class="nav-text">5. 运行测试，略</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89QADao%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">2）QADao接口的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BBQADaoImpl%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">3）接口实现类QADaoImpl的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89QAService%E4%B8%9A%E5%8A%A1%E5%B1%82%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">4）QAService业务层接口的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%89%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BBQAServiceImpl%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">5）接口实现类QAServiceImpl的编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%89%E9%97%AE%E7%AD%94%E6%A8%A1%E5%9D%97Servlet%E5%B1%82%E7%9A%84%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">6）问答模块Servlet层的编写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-SearchServlet%E7%9A%84%E7%BC%96%E5%86%99%EF%BC%8C%E8%B4%9F%E8%B4%A3%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E7%9A%84%E9%97%AE%E9%A2%98%E6%90%9C%E7%B4%A2%E8%AF%B7%E6%B1%82%EF%BC%88%E5%8A%A0%E5%85%A5%E4%BA%86%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%EF%BC%8C%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%BF%9B%E8%A1%8C%E9%97%AE%E9%A2%98%E7%9A%84%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="nav-number">1.2.3.6.1.</span> <span class="nav-text">1. SearchServlet的编写，负责处理用户的问题搜索请求（加入了自然语言处理，在数据库中进行问题的相似度匹配）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-ShowQAServlet%E7%9A%84%E7%BC%96%E5%86%99%EF%BC%8C%E8%B4%9F%E8%B4%A3%E5%90%91%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%83%A8%E5%88%86%E4%BF%A1%E6%81%AF%E3%80%82"><span class="nav-number">1.2.3.6.2.</span> <span class="nav-text">2. ShowQAServlet的编写，负责向前端展示数据库的部分信息。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%AF%B9%E5%BA%94%E5%9C%A8web-xml%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84-1"><span class="nav-number">1.2.3.6.3.</span> <span class="nav-text">3. 对应在web.xml文件中添加请求映射</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%EF%BC%89%E5%89%8D%E7%AB%AFjsp%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">7）前端jsp页面代码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-main-jsp"><span class="nav-number">1.2.3.7.1.</span> <span class="nav-text">1. main.jsp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-left-jsp"><span class="nav-number">1.2.3.7.2.</span> <span class="nav-text">2. left.jsp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-top-jsp"><span class="nav-number">1.2.3.7.3.</span> <span class="nav-text">3. top.jsp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-search-jsp"><span class="nav-number">1.2.3.7.4.</span> <span class="nav-text">4. search.jsp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-showQA-jsp"><span class="nav-number">1.2.3.7.5.</span> <span class="nav-text">5. showQA.jsp</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%EF%BC%89%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%EF%BC%88NLP%EF%BC%89"><span class="nav-number">1.2.3.8.</span> <span class="nav-text">8）自然语言处理（NLP）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86"><span class="nav-number">1.2.3.8.1.</span> <span class="nav-text">1. 理论知识</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.3.8.2.</span> <span class="nav-text">2. 计算过程示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="nav-number">1.2.3.8.3.</span> <span class="nav-text">3. 代码编写</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9%EF%BC%89%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E7%95%A5"><span class="nav-number">1.2.3.9.</span> <span class="nav-text">9）运行测试，略</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E7%B3%BB%E7%BB%9F%E7%95%8C%E9%9D%A2"><span class="nav-number">1.3.</span> <span class="nav-text">3、系统界面</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="君莫良"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">君莫良</p>
  <div class="site-description" itemprop="description">世人慌慌张张，不过图碎银几两</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CoderZQY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CoderZQY" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

      <div id="music163player">
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 		src="//music.163.com/outchain/player?type=2&id=36496695&auto=0&height=66">
	</iframe>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">君莫良</span>
</div>
<!--
-->

<div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/01/2021 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  



<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
